{% extends "workouts/layout.html" %}
{% load static %}
{% block title %}Dashboard | IronLog{% endblock %}

{% block body %}
<div class="container mt-5" style="max-width: 900px;">

  <!-- T칤tulo + filtros -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>游늵 Training Volume</h2>
    <div>
      <a href="?period=weekly" class="btn btn-sm {% if period == 'weekly' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        Weekly
      </a>
      <a href="?period=monthly" class="btn btn-sm {% if period == 'monthly' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        Monthly
      </a>
    </div>
  </div>

  <!-- Gr치fico 1: Volume ao longo do tempo -->
  <div class="card shadow-sm p-4 mb-4">
    <h5 class="text-center mb-3">Total Training Volume Over Time</h5>
    <canvas id="volumeChart" height="100"></canvas>
  </div>

  <!-- Gr치fico 2: Volume por exerc칤cio -->
  <div class="card shadow-sm p-4 mb-4">
    <h5 class="text-center mb-3">Volume by Exercise</h5>
    <canvas id="exerciseChart" height="120"></canvas>
  </div>

  <!-- Gr치fico 3: PR Progression -->
  <div class="card shadow-sm p-4 mb-4">
    <h5 class="text-center mb-3">游끥 PR Progression (Squat / Bench / Deadlift)</h5>
    <canvas id="prChart" height="120"></canvas>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Dados JSON seguros -->
{{ labels|json_script:"labels-data" }}
{{ volumes|json_script:"volumes-data" }}
{{ exercise_labels|json_script:"exercise-labels-data" }}
{{ exercise_volumes|json_script:"exercise-volumes-data" }}
{{ pr_labels|json_script:"pr-labels-data" }}
{{ squat_weights|json_script:"squat-weights-data" }}
{{ bench_weights|json_script:"bench-weights-data" }}
{{ deadlift_weights|json_script:"deadlift-weights-data" }}

<script>
  const labels = JSON.parse(document.getElementById("labels-data").textContent);
  const volumes = JSON.parse(document.getElementById("volumes-data").textContent);
  const exLabels = JSON.parse(document.getElementById("exercise-labels-data").textContent);
  const exVolumes = JSON.parse(document.getElementById("exercise-volumes-data").textContent);
  const prLabels = JSON.parse(document.getElementById("pr-labels-data").textContent);
  const squatWeights = JSON.parse(document.getElementById("squat-weights-data").textContent);
  const benchWeights = JSON.parse(document.getElementById("bench-weights-data").textContent);
  const deadliftWeights = JSON.parse(document.getElementById("deadlift-weights-data").textContent);

  // Gr치fico 1 - Volume ao longo do tempo
  new Chart(document.getElementById("volumeChart"), {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: "Training Volume (kg lifted)",
        data: volumes,
        borderColor: "rgba(54, 162, 235, 1)",
        backgroundColor: "rgba(54, 162, 235, 0.2)",
        tension: 0.3,
        fill: true
      }]
    }
  });

  // Gr치fico 2 - Volume por exerc칤cio
  new Chart(document.getElementById("exerciseChart"), {
    type: "bar",
    data: {
      labels: exLabels,
      datasets: [{
        label: "Volume (kg)",
        data: exVolumes,
        backgroundColor: "rgba(75, 192, 192, 0.4)",
        borderColor: "rgba(75, 192, 192, 1)",
        borderWidth: 1,
      }]
    }
  });

  // Gr치fico 3 - PR Progression
  new Chart(document.getElementById("prChart"), {
    type: "line",
    data: {
      labels: prLabels,
      datasets: [
        {
          label: "Squat",
          data: squatWeights,
          borderColor: "rgba(255, 99, 132, 1)",
          backgroundColor: "rgba(255, 99, 132, 0.2)",
          tension: 0.3,
          fill: false,
        },
        {
          label: "Bench",
          data: benchWeights,
          borderColor: "rgba(255, 206, 86, 1)",
          backgroundColor: "rgba(255, 206, 86, 0.2)",
          tension: 0.3,
          fill: false,
        },
        {
          label: "Deadlift",
          data: deadliftWeights,
          borderColor: "rgba(75, 192, 192, 1)",
          backgroundColor: "rgba(75, 192, 192, 0.2)",
          tension: 0.3,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "Best Lift Progression Over Time"
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: "Weight (kg)" }
        }
      }
    }
  });
</script>
{% endblock %}
